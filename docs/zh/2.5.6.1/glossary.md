# 名词解释

## 常用名词

### 集群

集群通常指使用分布式事务数据库HotDB Server所需要搭建的整套架构组件的 整体。一般包含计算节点、存储节点、配置库、管理平台、备份程序等。不同集 群在业务上是独立的，管理平台中也可以同时管理多套集群业务。

### 计算节点

计算节点是分布式事务数据库HotDB Server集群体系的核心，主要提供SQL解 析、路由分发、结果集合并等分布式事务数据库的核心控制功能，是整个分布式 服务的命脉所在。一般在没有特殊声明的情况下文档中提及的HotDB Server、 HotDB、HotDB-Server都指计算节点。

- **服务端口：**计算节点会对外开放两个端口，服务端口为其中之一。服务端口一般默认为3323，是客户端应用连接计算节点获取数据服务的通道。类似于MySQL实例的端口。
- **管理端口：**该端口是计算节点对外开放的另一端口，主要为外界提供信息监控与管理功能。例如查看当前计算节点中连接的客户端连接信息、重建连接池等。

### 配置库

配置库实质上是一个MySQL实例中的数据库，主要负责存储计算节点或管理平台 相关配置信息，也用于暂存部分复杂查询语句的中间结果集。配置库可通过主从 或MGR进行高可用配置。

### 数据节点

数据节点（Datanode,可以简称为DN）是一组具有相同数据副本的存储节点的统 称。数据节点可以是一个MySQL MGR集群，也可以是一个MySQL主从复制集群。 数据节点管理一组存储节点（具有相同数据副本）的复制关系。数据节点在HotDB中作为一个分片数据存在，所有的数据节点一起构成HotDB的全量数据。

### DNID

DNID又称Datanode或datanode_id，即数据节点的编号。

### 存储节点

存储节点（Datasouce,可以简称为DS）是实际存储业务数据的MySQL数据库， 一个MySQL实例(IP+端口+物理库)即为一个存储节点。为了实现高可用和数据多 副本功能，HotDB中将具有相同数据副本的一组（多个）存储节点称为一个数据 节点。

### 切换规则

高可用切换功能可为存储节点提供高可用的保障但前提需要用户在管理平台中 为数据节点下的存储节点配置切换规则，也即主存储节点发生故障时切换到备库 的配置信息及其优先级。未配置切换规则的数据节点在底下的主存储节点发生故 障时不会做切换操作。

### 心跳

心跳是计算节点对存储节点高可用的检测策略。计算节点会定时向底层存储节点 发送心跳检测，若存储节点正常反馈计算节点的检测则代表存储节点目前状态正 常。若在规定时间与次数内未对计算节点的检测做反馈则计算节点认为该存储节 点状态异常，进而执行数据节点高可用切换操作。

### 存储节点组

将一组具有相同属性的存储节点划分归类为一个存储节点组，当用户需要批量修 改这一组内所有存储节点的属性为同一个值时，可以直接修改存储节点组的属性 值，该组的所有存储节点的对应属性值全部修改为新值。该功能可方便修改一批具有共性的存储节点属性值且有利于保持其设置一致。

### 逻辑库

逻辑库（LogicDatabase，可以简称为LDB）指客户端程序连接计算节点服务器 后，可以访问的数据库，描述数据库表的集合。类似于直接连接MySQL服务后， 看到的一个数据库。逻辑库是产品引申出来的概念，在实际中没有单一具体的实 体。

### 表信息

表信息指在管理平台中定义的用户自身业务的数据库表的配置规则信息，定义的 表需要在计算节点数据服务端口创建表结构后才能正常使用。目前支持创建：水 平分片表、垂直分片表、全局表、子表四种类型的表。

| 表类型     | 定义                                                                                                                                                                   |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 水平分片表 | 水平分片表是指将表的数据按行以分片列的分片规则进行拆分， 拆分后的分片数据存储不同的数据节点。数据量大的表适合定义 为水平分片表。                                       |
| 全局表     | 全局表是指在该逻辑库下的所有数据节点中都存储的表，所有数 据节点中该表的表结构和数据都完全一致。数据量小、不会频繁 DML、经常与其他表发生JOIN 操作的表适合作为全局表。   |
| 垂直分片表 | 垂直分片表是一个全局唯一且不分片的全量表，垂直分片表的全 量数据仅存储在一个数据节点。                                                                                  |
| 子表       | 通过父表（水平分片表）的关联字段将父子表关联，子表数据按 照关联字段的数值跟随其父表关联字段位置进行存储。创建子表 有利于减少一部分跨库数据操作，但目前已不再推荐使用。 |

### 分片规则

分片规则又称拆分规则，通过相应的分片函数对分片表中的数据进行对应的数据 拆分，分片规则决定了一条分片字段数据为某特定数值的数据记录存储于哪一个 数据节点之上。目前计算节点支持分片类型有：ROUTE，RANGE，MATCH，HASH（2.4.6 版本之后开始弃用），SIMPLE_MOD，CRC32_MOD（2.4.7版本新增）， AUTO（2.4.6 版本之后开始启用），AUTO_CRC32（2.4.7版本新增）， AUTO_MOD（2.4.7版本新 增）。

**分片字段**

分片字段又称拆分字段，它是分片规则对表数据进行分片路由时的判断依据。分片规则将分片字段值作为分片函数的输入值进行计算，并依据结果进行相应的数据拆分。

### 数据库用户

用于连接计算节点访问具体逻辑库或登录计算节点管理端口的账户。类似于 MySQL中的用户概念，用户信息具体需要在管理平台中进行配置管理。

## 组件名词介绍

### 计算节点

具体说明请参照常用名词中[计算节点](#计算节点)描述。

### NDBSQL服务

NDB SQL服务是为计算节点支持复杂查询类SQL 场景引入的服务程序，用于在分布式环境下完成相对复杂的查询语句的计算。

### 管理平台

分布式事务数据库平台又称为HotDB Management，可实现对计算节点数据库用户、数据节点、表类型、分片规则等信息的易用性配置，同时可提供计算节点服 务状态监控、异常事件提醒、报表查看、任务管理等智能运维相关服务。

### 存储节点

具体说明请参照常用名词中[存储节点](#存储节点)描述。

### 配置库

具体说明请参照常用名词中[配置库](#配置库)描述。

### 高可用

HotDB Server的计算节点可通过Keepalived实现高可用。Keepalived负责计算 节点的主、备切换和VIP漂移。

### 负载均衡

HotDB Server的计算节点集群模式可通过LVS/F5实现高可用和负载均衡。应用 通过LVS的VIP访问HotDB Server的分布式事务数据库服务，分布式事务数据 库服务对应用程序透明，计算节点集群中单个或多个节点故障对应用程序无影 响。

### HotDB Backup

热璞数据库自研的分布式事务数据库备份程序，负责业务数据的备份。

### HotDB Listener

热璞数据库自研的分布式事务数据库监听程序，可解决强一致模式下计算节点性能 线性扩展问题，简称Listener。

## HotDB Management相关名词

### 集群模式

集群模式为计算节点在实际部署时的一种架构。一般通过计算节点个数可判断当 前计算节点的集群模式。目前支持三种集群模式，分别为：单节点、主备节点、 多节点。

**单节点**

集群模式为单节点时，实际部署的架构中只有一个计算节点实例，也叫作单主集群模式。此种架构不具备计算节点高可用功能，可在测试环境部署但不建议在生产环境中选择。

**主备节点：**

集群模式为主备节点时，实际部署的架构中会有两个计算节点实例，分别为主计算节点、备计算节点，也叫作HA集群模式。该模式下计算节点有主备角色状态，依赖Keepalived组件检测计算节点的健康状态以及VIP的维护。

**多节点：**

集群模式为多节点时，实际部署的架构中会有多个计算节点实例（实例个数大于等于3小于等于9）。各计算节点实例可通过负载均衡组件实现流量的均匀或自定义分发，且保证集群中只要还有一个计算节点实例可用，业务都不会中断。

### 计算节点高可用切换

通常指集群模式为主备的计算节点，在主计算节点发生故障时Keepalived将VIP 漂移至备计算节点。此时由备计算节点接管前端应用服务响应需求。高可用切换 可发生在主计算节点故障时或人为手动进行切换。

### 高可用环境重建

通常指集群模式为主备的计算节点，在发生故障高可用切换后需要人为进行高可 用环境重建操作，为下一次发生故障时计算节点能够顺利再次切换做好准备。如 果不进行重建，切换后的计算节点后续再发生故障时无法成功自动切换。高可用 环境重建主要对主备计算节点以及Keepalived相关配置进行对应修改，以满足遇到故障可自动切换的条件。

## 跨机房容灾名词介绍

### 容灾模式与单机房模式

在两个机房内协调部署了具有容灾关系的完整计算节点集群运行所需组件，称这 个集群为开启容灾模式的集群。

反之，未开启容灾模式的计算节点集群即为单机房模式的集群。

### 机房类型与机房状态

机房类型分为中心机房和容灾机房。机房类型仅用于标识区别两个机房，且不随 机房服务状态改变而改变。在HotDB Server产品使用过程中，以添加计算节点 集群组管理为入口可以区分中心机房和容灾机房。

机房状态分为当前主机房和当前备机房，根据机房内的主计算节点是否提供服务 （默认3323服务端口）判断机房类型。当前主计算节点提供服务的机房即为当 前主机房；与当前主机房配套提供机房级别高可用服务切换的备用机房为当前备 机房。

